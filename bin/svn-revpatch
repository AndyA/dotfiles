#!/usr/bin/env perl

use strict;
use warnings;
use Set::IntSpan::Fast;

if ( @ARGV ) {
  svn_revpatches( @ARGV );
}
else {
  my %rev = ();
  while ( <> ) {
    $rev{$1}++ while /\[(\d+)\]/g;
  }
  svn_revpatches( sort { $a <=> $b } keys %rev );
}

sub svn_revpatches {
  my $set  = Set::IntSpan::Fast->new( @_ );
  my $iter = $set->iterate_runs;
  while ( my ( $from, $to ) = $iter->() ) {
    svn_revpatch( $from - 1, $to );
  }
}

sub svn_revpatch {
  my ( $from, $to ) = @_;
  print STDERR "svn diff -r${from}:${to}\n";
  system 'svn', 'diff', "-r${from}:${to}";
}

# vim:ts=2:sw=2:sts=2:et:ft=perl

