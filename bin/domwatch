#!/bin/bash

email="andy@hexten.net"
tmp="/tmp/domwatch"
rm -rf "$tmp"
mkdir -p "$tmp"

while sleep 5; do
  for dom in "$@"; do
    df="$tmp/dom"
    prev="$df.prev"
    touch "$prev"
    [ -f "$df" ] && mv "$df" "$prev"
    whois "$dom" | grep -v '^>>> Last update' > "$df"
    diff "$prev" "$df" > /dev/null 2>&1 || {
      echo "To: andy@hexten.net"
      echo "From: andy@hexten.net"
      echo "Subject: $dom changed"
      echo
      cat "$df"
    } | sendmail -t 
  done
done

# vim:ts=2:sw=2:sts=2:et:ft=sh

