#!/bin/bash

rspec="$1"
loc="$2"
rem="$3"

[ -z "$rem" ] && {
  echo "Usage: rtar rhost localdir remotedir" 1>&2
  exit 1
}

host=${rspec/#*@/}

cd "$loc"
ssh "$rspec" "mkdir -p '$rem' && cd '$rem' && nc -l -p 7000 | tar x" &
rpid=$!
sleep 2
tar c . | nc -w 10 -q 0 $host 7000
wait $rpid

# vim:ts=2:sw=2:sts=2:et:ft=sh

