#!/bin/bash

rspec="$1"
loc="$2"
rem="$3"

[ -z "$rem" ] && {
  echo "Usage: rtar rhost localdir remotedir" 1>&2
  exit 1
}

host=${rspec/#*@/}

cd "$loc"
ssh "$rspec" "mkdir -p '$rem' && cd '$rem' && netcat -l -p 7000 | tar x" &
sleep 1
tar c . | netcat -q 0 $host 7000

# vim:ts=2:sw=2:sts=2:et:ft=sh

