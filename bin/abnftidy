#!/usr/bin/env perl

use strict;
use warnings;

use List::Util qw( max );

my $bw = qr{
  (?: (?<=\s) | ^ ) 
  ( [-a-z]+ ) 
  (?: (?=\s) | $ )
}x;

my @lines     = ();
my %id        = ();
my $fmt       = undef;
my $last_name = undef;
while ( defined( my $line = <> ) ) {
  chomp $line;
  $line =~ s{^\s*=/}{$last_name =/}
   if defined $last_name;
  if ( $line =~ m{^$bw\s*(=/|=)\s*(.*)} ) {
    my ( $name, $op, $tail ) = ( $1, $2, $3 );
    $id{$name}++;
    push @lines, sub { sprintf $fmt, $name, $op, $tail };
    $last_name = $name;
  }
  else {
    push @lines, sub { $line };
  }
}

my $maxname = max map { length $_ } keys %id;

$fmt = "%-${maxname}s  %-2s %s";

print $_->(), "\n" for @lines;

# vim:ts=2:sw=2:sts=2:et:ft=perl

