#!/bin/sh

# Look for ffmpeg ignoring $PATH
for p in /usr/local/bin /opt/local/bin /alt/local/bin /usr/bin; do
  FFMPEG=$p/ffmpeg
  [ -x $FFMPEG ] && break
done

[ -z $BITRATE ] && BITRATE=1500000
[ -z $EXT     ] && EXT="mp4"
echo "ffmpeg:    $FFMPEG"
echo "bitrate:   $BITRATE"
echo "extension: $EXT"

for INFILE in $@; do
  OUTFILE="$INFILE.$EXT"
  set -x
  $FFMPEG -y -i "$INFILE" \
    -an \
    -pass 1 -vcodec libx264 -vpre slow_firstpass -b $BITRATE \
    -threads 0 "$OUTFILE" && \
  $FFMPEG -y -i "$INFILE" \
    -acodec libfaac -ab 192k \
    -pass 2 -vcodec libx264 -vpre slow -b $BITRATE \
    -threads 0 "$OUTFILE"
  set +x
done


# vim:ts=2:sw=2:sts=2:et:ft=sh
