#!/bin/sh

# Look for ffmpeg ignoring $PATH
for p in /usr/local/bin /opt/local/bin /alt/local/bin /usr/bin; do
  FFMPEG=$p/ffmpeg
  [ -x $FFMPEG ] && break
done

BITRATE=1500000

for INFILE in $@; do
  OUTFILE="$INFILE.mp4"
  set -x
  $FFMPEG -y -i "$INFILE" \
    -an \
    -pass 1 -vcodec libx264 -vpre fast_firstpass -vpre baseline -b $BITRATE \
    -threads 0 "$OUTFILE" && \
  $FFMPEG -y -i "$INFILE" \
    -acodec libfaac -ab 128k \
    -pass 2 -vcodec libx264 -vpre slow -vpre baseline -b $BITRATE \
    -threads 0 "$OUTFILE"
  set +x
done


# vim:ts=2:sw=2:sts=2:et:ft=sh
