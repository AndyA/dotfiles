#!/usr/bin/env perl

use strict;
use warnings;

use Term::ANSIColor;
use IPC::Run qw( run );
use Data::Dumper;
use Getopt::Long qw(
 :config require_order bundling auto_help auto_version
);

our $VERSION = '0.01';

GetOptions( 'R|rules:s@' => \my @rules, )
 or die "Use $0 --help to see options.\n";

die "Please supply a command to run\n" unless @ARGV;

run \@ARGV, '>', sub { filter( out => @_ ) },
 '2>', sub { filter( err => @_ ) };

exit $?;

sub filter {
  my ( $chan, $line ) = @_;
  return unless defined $line and length $line;
  if ( $chan eq 'err' ) {
    print STDERR colored( ['red'], $line );
  }
  else {
    print $line;
  }
}

=head1 SYNOPSIS

chrom [options] [program]

=head2 Options

=over

=item -R, --rules <file>

Specify the name of a rules file to include.

=back

=cut

# vim:ts=2:sw=2:sts=2:et:ft=perl

