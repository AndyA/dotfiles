#!/usr/bin/env perl

use strict;
use warnings;

use Fcntl qw( SEEK_CUR );

use constant WAIT  => 30;
use constant CHUNK => 8192;

while ( my $file = shift ) {
  my $last_read = time;
  open my $fh, '<', $file or die "Can't read $file: $!\n";

  TRY: while ( time - $last_read < WAIT ) {
    my $got = sysread $fh, my $buf, CHUNK;
    die "Read error: $!\n" unless defined $got;
    unless ( $got ) {
      sysseek $fh, 0, SEEK_CUR;
      sleep 2;
      next TRY;
    }
    syswrite STDOUT, $buf;
    $last_read = time;
  }
}

# vim:ts=2:sw=2:sts=2:et:ft=perl
