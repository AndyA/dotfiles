#!/bin/bash

set -e

platform=$( uname -s)

fatal() {
  echo "Fatal: $*" >&2
  exit 1
}

# Sync some stuff

gith pull

[[ -x ~/.atuin/bin/atuin ]] && atuin sync

# Update packages

case $platform in
  Darwin)
    brew update && brew upgrade
    ;;
  Linux)
    distro=$( lsb_release -is )
    case $distro in
      Debian|Ubuntu)
        sudo apt update && sudo apt upgrade -y
        ;;
      *)
        fatal "Don't know how to update $platform/$distro"
        ;;
    esac

    # DuckDB (brew on Darwin)
    ~/bin/duckup
    ;;
  *)
    fatal "Don't know how to update $platform"
    ;;
esac

# Some others

if which uv > /dev/null; then
  uv self update
else
  curl -LsSf https://astral.sh/uv/install.sh | sh
fi

# vim:ts=2:sw=2:sts=2:et:ft=sh

