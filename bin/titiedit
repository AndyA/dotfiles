#!/bin/sh
#
# Editor wrapper for titi commit
#

file=$1
temp="$file.work"
orig="$file.orig"

echo > $temp
titi get --nowrite >> $temp
cat $file >> $temp
mv $file $orig
cp $temp $file

# Invoke editor without redirection
$TITI_EDITOR $* < /dev/tty > /dev/tty 2> /dev/tty

# If we didn't edit the message restore svn's original so it also
# doesn't see an edit
diff -q $temp $file > /dev/null && mv $orig $file
rm -f $temp $orig
