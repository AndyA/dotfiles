#!/bin/bash

FFMPEG=$(which ffmpeg)

[ -z $BITRATE   ] && BITRATE=4500000
[ -z $FRAMERATE ] && FRAMERATE=25
[ -z $SIZE      ] && SIZE="1280x720"

echo "ffmpeg:      $FFMPEG"
echo "bitrate:     $BITRATE"
echo "framerate:   $FRAMERATE"

for INFILE in "$@"; do
  OUTFILE="$(dirname "$INFILE")/preview/$(basename "$INFILE")"
  set -x
  mkdir -p "$(dirname "$OUTFILE")"
  $FFMPEG -y -i "$INFILE" \
    -acodec libfaac -ab 128k -r 44100 \
    -vcodec libx264 -b $BITRATE -vpre fast \
    -r $FRAMERATE -s $SIZE \
    -threads 0 "$OUTFILE"
  set +x
done

# vim:ts=2:sw=2:sts=2:et:ft=sh
